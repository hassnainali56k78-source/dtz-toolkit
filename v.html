<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tool Viewer - Dark Zone Toolkit</title>

<style>
body {
  margin: 0;
  background: #050a14;
  color: #fff;
  font-family: system-ui, -apple-system, sans-serif;
}

#loading {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: #050a14;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid #00eaff33;
  border-top-color: #00eaff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 15px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

iframe {
  width: 100%;
  height: 100vh;
  border: none;
  background: #fff;
}

.back-btn {
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 100;
  padding: 10px 16px;
  border-radius: 30px;
  border: none;
  background: #00eaff;
  color: #000;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 234, 255, 0.3);
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.back-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0, 234, 255, 0.4);
}

.tool-title {
  position: fixed;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  background: rgba(5, 10, 20, 0.9);
  border: 1px solid #00eaff44;
  border-radius: 20px;
  padding: 8px 20px;
  color: #00eaff;
  font-size: 14px;
  font-weight: 600;
  backdrop-filter: blur(10px);
}
</style>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>
<body>

<button class="back-btn" onclick="location.href='index.html'">
  <span>‚Üê</span> Back to Toolkit
</button>

<div id="loading">
  <div class="spinner"></div>
  <div>Loading tool...</div>
</div>

<iframe id="frame"></iframe>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBvgAQeSP5B8mKICA-4vHRY0CaO8MyeizU",
  authDomain: "dark-zone-toolkit-d67ab.firebaseapp.com",
  projectId: "dark-zone-toolkit-d67ab"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const toolId = new URLSearchParams(location.search).get("id");

// Load tool info first
db.collection("tools").doc(toolId).get().then(toolDoc => {
  if (toolDoc.exists) {
    const toolName = toolDoc.data().name;
    document.title = `${toolName} - Dark Zone Toolkit`;
    
    // Add tool name display
    const titleEl = document.createElement('div');
    titleEl.className = 'tool-title';
    titleEl.textContent = toolName;
    document.body.appendChild(titleEl);
  }
});

// Load hosted tool HTML
db.collection("hosted_tools").doc(toolId).get().then(doc => {
  const loading = document.getElementById('loading');
  
  if (doc.exists) {
    const html = doc.data().html;
    
    // Sanitize and prepare HTML
    const fullHTML = `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
          body { margin: 0; padding: 15px; background: #f5f5f5; }
          * { box-sizing: border-box; }
        </style>
      </head>
      <body>
        ${html}
      </body>
      </html>
    `;
    
    document.getElementById('frame').srcdoc = fullHTML;
  } else {
    document.getElementById('frame').srcdoc = `
      <div style="padding: 40px; text-align: center; font-family: system-ui;">
        <h2 style="color: #333;">Tool Not Found</h2>
        <p style="color: #666;">The requested tool is no longer available.</p>
        <button onclick="window.location.href='index.html'" 
                style="padding: 10px 20px; background: #00eaff; color: #000; border: none; border-radius: 8px; cursor: pointer;">
          Return to Toolkit
        </button>
      </div>
    `;
  }
  
  // Hide loading after a minimum delay for better UX
  setTimeout(() => {
    loading.style.display = 'none';
  }, 500);
}).catch(error => {
  document.getElementById('loading').innerHTML = `
    <div style="text-align: center; padding: 20px;">
      <div style="color: #ff4757; margin-bottom: 15px;">
        <i class="fas fa-exclamation-triangle" style="font-size: 40px;"></i>
      </div>
      <h3>Error Loading Tool</h3>
      <p>${error.message}</p>
      <button onclick="location.href='index.html'" 
              style="padding: 10px 20px; background: #00eaff; color: #000; border: none; border-radius: 8px; cursor: pointer; margin-top: 15px;">
        Go Back
      </button>
    </div>
  `;
});
</script>
</body>
</html>