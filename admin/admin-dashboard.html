<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Dark Tech Zone</title>
    <link rel="stylesheet" href="/admin/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="admin-sidebar">
            <div class="sidebar-header">
                <div class="admin-logo">
                    <div class="admin-logo-shield">
                        <svg width="40" height="48" viewBox="0 0 40 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 0L40 12V36L20 48L0 36V12L20 0Z" fill="#00ff00" fill-opacity="0.2"/>
                            <path d="M20 4L36 14V34L20 44L4 34V14L20 4Z" fill="none" stroke="#00ff00" stroke-width="2"/>
                            <path d="M20 16L28 20V28L20 32L12 28V20L20 16Z" fill="#00ff00" fill-opacity="0.4"/>
                            <circle cx="20" cy="24" r="3" fill="#00ff00"/>
                        </svg>
                    </div>
                    <div class="admin-logo-text">
                        <h2>DARK TECH ZONE</h2>
                        <p class="admin-tagline">Admin Control Panel</p>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-user" id="admin-user-info">
                <div class="user-avatar">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="user-details">
                    <h3 id="admin-name">Loading...</h3>
                    <p class="user-role">
                        <span class="role-badge">ADMIN</span>
                        <span id="admin-email">admin@darktech.zone</span>
                    </p>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="/admin/admin-dashboard.html" class="nav-item active">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/admin/admin-tools.html" class="nav-item">
                    <i class="fas fa-tools"></i>
                    <span>Tools Management</span>
                </a>
                <a href="/admin/admin-analytics.html" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analytics</span>
                    <span class="nav-badge" id="analytics-badge">0</span>
                </a>
                <a href="/admin/admin-settings.html" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <div class="nav-divider"></div>
                <a href="/" class="nav-item">
                    <i class="fas fa-external-link-alt"></i>
                    <span>View Public Site</span>
                </a>
                <button id="admin-logout" class="nav-item logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </nav>
            
            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-item">
                        <span class="status-label">System:</span>
                        <span class="status-value online">Operational</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Last Login:</span>
                        <span class="status-value" id="last-login">--:--:--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="admin-main">
            <div class="admin-header">
                <div class="header-title">
                    <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
                    <p class="header-subtitle">Dark Tech Zone Toolkit Control Center</p>
                </div>
                
                <div class="header-actions">
                    <div class="quick-stats">
                        <div class="stat-card mini">
                            <div class="stat-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-tools">0</span>
                                <span class="stat-label">Tools</span>
                            </div>
                        </div>
                        <div class="stat-card mini">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-users">0</span>
                                <span class="stat-label">Users Today</span>
                            </div>
                        </div>
                        <div class="stat-card mini">
                            <div class="stat-icon">
                                <i class="fas fa-mouse-pointer"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-clicks">0</span>
                                <span class="stat-label">Clicks Today</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="admin-content">
                <!-- Quick Actions -->
                <div class="dashboard-section">
                    <h2 class="section-title">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h2>
                    
                    <div class="quick-actions-grid">
                        <a href="/admin/admin-tools.html" class="quick-action-card">
                            <div class="action-icon add">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <h3>Add New Tool</h3>
                            <p>Create a new direct link or hosted tool</p>
                        </a>
                        
                        <a href="/admin/admin-tools.html" class="quick-action-card">
                            <div class="action-icon edit">
                                <i class="fas fa-edit"></i>
                            </div>
                            <h3>Manage Tools</h3>
                            <p>Edit, disable or delete existing tools</p>
                        </a>
                        
                        <a href="/admin/admin-settings.html" class="quick-action-card">
                            <div class="action-icon settings">
                                <i class="fas fa-broadcast-tower"></i>
                            </div>
                            <h3>Update Broadcast</h3>
                            <p>Change welcome or broadcast message</p>
                        </a>
                        
                        <a href="/admin/admin-analytics.html" class="quick-action-card">
                            <div class="action-icon analytics">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>View Analytics</h3>
                            <p>Check tool usage and user statistics</p>
                        </a>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="dashboard-section">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i> Recent Activity
                    </h2>
                    
                    <div class="activity-list" id="recent-activity">
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-spinner fa-spin"></i>
                            </div>
                            <div class="activity-content">
                                <p>Loading recent activity...</p>
                                <span class="activity-time">Just now</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Status -->
                <div class="dashboard-section">
                    <h2 class="section-title">
                        <i class="fas fa-server"></i> System Status
                    </h2>
                    
                    <div class="status-grid">
                        <div class="status-card">
                            <div class="status-header">
                                <h3><i class="fas fa-database"></i> Firebase Firestore</h3>
                                <span class="status-indicator online"></span>
                            </div>
                            <p class="status-desc">Primary data storage for tools and settings</p>
                            <div class="status-stats">
                                <span>Tools: <strong id="firestore-tools">0</strong></span>
                                <span>Settings: <strong id="firestore-settings">0</strong></span>
                            </div>
                        </div>
                        
                        <div class="status-card">
                            <div class="status-header">
                                <h3><i class="fas fa-chart-bar"></i> Realtime Database</h3>
                                <span class="status-indicator online"></span>
                            </div>
                            <p class="status-desc">Analytics and click tracking</p>
                            <div class="status-stats">
                                <span>Total Clicks: <strong id="rtdb-clicks">0</strong></span>
                                <span>Sessions: <strong id="rtdb-sessions">0</strong></span>
                            </div>
                        </div>
                        
                        <div class="status-card">
                            <div class="status-header">
                                <h3><i class="fas fa-user-shield"></i> Authentication</h3>
                                <span class="status-indicator online"></span>
                            </div>
                            <p class="status-desc">Admin authentication system</p>
                            <div class="status-stats">
                                <span>Admins: <strong id="auth-admins">0</strong></span>
                                <span>Active: <strong id="auth-active">1</strong></span>
                            </div>
                        </div>
                        
                        <div class="status-card">
                            <div class="status-header">
                                <h3><i class="fas fa-globe"></i> Vercel Hosting</h3>
                                <span class="status-indicator online"></span>
                            </div>
                            <p class="status-desc">Static site hosting and distribution</p>
                            <div class="status-stats">
                                <span>Uptime: <strong>100%</strong></span>
                                <span>SSL: <strong class="online">Active</strong></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="/admin/js/auth-guard.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID",
            databaseURL: "YOUR_DATABASE_URL"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load tools count
                const toolsSnapshot = await getDocs(collection(db, 'tools'));
                document.getElementById('total-tools').textContent = toolsSnapshot.size;
                document.getElementById('firestore-tools').textContent = toolsSnapshot.size;
                
                // Load settings count
                const settingsSnapshot = await getDocs(collection(db, 'settings'));
                document.getElementById('firestore-settings').textContent = settingsSnapshot.size;
                
                // Load recent activity
                const activityQuery = query(
                    collection(db, 'admin_logs'),
                    orderBy('timestamp', 'desc'),
                    limit(5)
                );
                
                const activitySnapshot = await getDocs(activityQuery);
                const activityList = document.getElementById('recent-activity');
                activityList.innerHTML = '';
                
                if (activitySnapshot.empty) {
                    activityList.innerHTML = `
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="activity-content">
                                <p>No recent activity found</p>
                                <span class="activity-time">System startup</span>
                            </div>
                        </div>
                    `;
                } else {
                    activitySnapshot.forEach(doc => {
                        const data = doc.data();
                        const time = data.timestamp?.toDate?.() || new Date();
                        const timeStr = time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                        
                        activityList.innerHTML += `
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-${data.icon || 'cog'}"></i>
                                </div>
                                <div class="activity-content">
                                    <p>${data.action || 'Activity'}</p>
                                    <span class="activity-time">${timeStr}</span>
                                </div>
                            </div>
                        `;
                    });
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        // Handle logout
        document.getElementById('admin-logout').addEventListener('click', async () => {
            try {
                await signOut(auth);
                localStorage.removeItem('admin_session');
                window.location.href = '/admin/admin.html';
            } catch (error) {
                console.error('Logout error:', error);
                alert('Logout failed. Please try again.');
            }
        });
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // Set last login time
            const lastLogin = localStorage.getItem('last_admin_login');
            if (lastLogin) {
                const date = new Date(parseInt(lastLogin));
                document.getElementById('last-login').textContent = 
                    date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }
            
            // Load dashboard data
            loadDashboardData();
            
            // Update user info
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    document.getElementById('admin-name').textContent = user.displayName || 'Admin User';
                    document.getElementById('admin-email').textContent = user.email;
                    
                    // Store last login
                    localStorage.setItem('last_admin_login', Date.now().toString());
                }
            });
            
            // Auto-refresh every 30 seconds
            setInterval(loadDashboardData, 30000);
        });
    </script>
</body>
</html>