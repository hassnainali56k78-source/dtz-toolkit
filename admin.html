<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin ‚Äì Dark Zone Toolkit</title>

<style>
:root {
  --bg: #050a14;
  --card: #0b1220;
  --border: #00eaff44;
  --primary: #00eaff;
  --text: #e6faff;
  --danger: #ff4757;
  --success: #00eaff;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, -apple-system, sans-serif;
  padding: 20px;
  max-width: 1400px;
  margin: 0 auto;
}

h2 {
  color: var(--primary);
  margin-bottom: 30px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--border);
}

h3 {
  color: var(--text);
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 18px;
}

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  margin-bottom: 20px;
}

.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

@media (max-width: 768px) {
  .grid-2 {
    grid-template-columns: 1fr;
  }
}

input, textarea, select, button {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: rgba(255, 255, 255, 0.05);
  color: var(--text);
  font-size: 14px;
}

input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(0, 234, 255, 0.1);
}

button {
  background: var(--primary);
  color: var(--bg);
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 10px;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 234, 255, 0.3);
}

button.secondary {
  background: transparent;
  color: var(--primary);
  border: 1px solid var(--primary);
}

button.danger {
  background: var(--danger);
  color: white;
}

.btn-group {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.btn-group button {
  flex: 1;
  margin: 0;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.stat-card {
  background: rgba(0, 234, 255, 0.1);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 15px;
  text-align: center;
}

.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: var(--primary);
  margin: 5px 0;
}

.stat-label {
  font-size: 12px;
  color: var(--text);
  opacity: 0.8;
}

.tools-list {
  max-height: 300px;
  overflow-y: auto;
  margin-top: 15px;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px;
}

.tool-item {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.tool-info {
  display: flex;
  align-items: center;
  gap: 10px;
}

.tool-icon {
  font-size: 20px;
}

.tool-actions {
  display: flex;
  gap: 5px;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--success);
}

input:checked + .toggle-slider:before {
  transform: translateX(26px);
}

#loginForm {
  max-width: 400px;
  margin: 100px auto;
  text-align: center;
}

#loginForm input {
  margin-bottom: 15px;
}

.hidden {
  display: none;
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  border-bottom: 1px solid var(--border);
  padding-bottom: 10px;
}

.tab {
  padding: 10px 20px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  cursor: pointer;
  transition: all 0.3s;
}

.tab.active {
  background: var(--primary);
  color: var(--bg);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.report-item {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 10px;
}

.report-item.resolved {
  opacity: 0.6;
  border-color: var(--success);
}

.report-meta {
  font-size: 12px;
  color: var(--text);
  opacity: 0.7;
  margin-top: 5px;
}

.status-badge {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: bold;
  margin-left: 10px;
}

.status-pending {
  background: rgba(255, 193, 7, 0.2);
  color: #ffc107;
}

.status-resolved {
  background: rgba(0, 234, 255, 0.2);
  color: var(--primary);
}

.notification-form {
  background: rgba(0, 234, 255, 0.1);
  border: 1px solid var(--primary);
  border-radius: 10px;
  padding: 15px;
  margin-top: 15px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
</head>
<body>

<div id="loginForm" class="card">
  <h2>Admin Login</h2>
  <input type="email" id="loginEmail" placeholder="Admin Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
  <div id="loginError" style="color: var(--danger); margin-top: 10px; display: none;"></div>
</div>

<div id="adminPanel" class="hidden">
  <h2>Dark Zone Toolkit Admin Panel</h2>
  
  <div class="tabs">
    <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
    <button class="tab" onclick="switchTab('tools')">Tools</button>
    <button class="tab" onclick="switchTab('settings')">Settings</button>
    <button class="tab" onclick="switchTab('reports')">Reports</button>
    <button class="tab" onclick="switchTab('analytics')">Analytics</button>
    <button class="tab" onclick="switchTab('notifications')">Notifications</button>
    <button class="tab danger" onclick="logout()">Logout</button>
  </div>
  
  <!-- Dashboard Tab -->
  <div id="dashboard" class="tab-content active">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalTools">0</div>
        <div class="stat-label">Total Tools</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalClicks">0</div>
        <div class="stat-label">Total Clicks</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalUsers">0</div>
        <div class="stat-label">Total Users</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="pendingReports">0</div>
        <div class="stat-label">Pending Reports</div>
      </div>
    </div>
    
    <div class="card">
      <h3>Quick Actions</h3>
      <button onclick="switchTab('tools')">Add New Tool</button>
      <button onclick="switchTab('notifications')" class="secondary">Send Notification</button>
      <button onclick="switchTab('reports')" class="secondary">View Reports</button>
    </div>
  </div>
  
  <!-- Tools Management Tab -->
  <div id="tools" class="tab-content">
    <div class="grid-2">
      <div class="card">
        <h3>Add / Edit Tool</h3>
        <input id="toolId" placeholder="Tool ID (unique)">
        <input id="toolName" placeholder="Tool Name">
        <input id="toolIcon" placeholder="Icon (emoji or HTML)">
        <select id="toolType">
          <option value="direct">Direct Link</option>
          <option value="hosted">Hosted HTML</option>
        </select>
        <input id="toolUrl" placeholder="URL (for direct tools)">
        <textarea id="toolHtml" placeholder="HTML code (for hosted tools)" rows="8"></textarea>
        <div class="btn-group">
          <button onclick="saveTool()">Save Tool</button>
          <button onclick="clearToolForm()" class="secondary">Clear</button>
        </div>
        <div style="margin-top: 15px;">
          <label style="display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" id="toolEnabled" checked>
            <span>Enabled</span>
          </label>
          <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
            <input type="checkbox" id="toolPro">
            <span>PRO Tool</span>
          </label>
        </div>
      </div>
      
      <div class="card">
        <h3>Existing Tools</h3>
        <div class="tools-list" id="toolsList">
          <!-- Tools will be loaded here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Settings Tab -->
  <div id="settings" class="tab-content">
    <div class="card">
      <h3>Toolkit Settings</h3>
      <input id="toolkitName" placeholder="Toolkit Name">
      <input id="toolkitSubtitle" placeholder="Subtitle">
      <textarea id="welcomeMessage" placeholder="Welcome Message (HTML allowed)" rows="3"></textarea>
      <textarea id="broadcastMessage" placeholder="Broadcast Message" rows="2"></textarea>
      <input id="whatsappChannel" placeholder="WhatsApp Channel Link">
      <textarea id="footerText" placeholder="Footer HTML" rows="4"></textarea>
      <button onclick="saveSettings()">Save Settings</button>
    </div>
  </div>
  
  <!-- Reports Tab -->
  <div id="reports" class="tab-content">
    <div class="card">
      <h3>User Reports</h3>
      <div id="reportsList">
        <!-- Reports will be loaded here -->
      </div>
    </div>
  </div>
  
  <!-- Analytics Tab -->
  <div id="analytics" class="tab-content">
    <div class="card">
      <h3>Tool Analytics</h3>
      <div id="analyticsList">
        <!-- Analytics will be loaded here -->
      </div>
    </div>
  </div>
  
  <!-- Notifications Tab -->
  <div id="notifications" class="tab-content">
    <div class="card">
      <h3>Send Notification</h3>
      <textarea id="notificationMessage" placeholder="Notification message" rows="3"></textarea>
      <select id="notificationType">
        <option value="info">Info</option>
        <option value="success">Success</option>
        <option value="warning">Warning</option>
        <option value="error">Error</option>
      </select>
      <div class="btn-group">
        <button onclick="sendNotification()">Send Notification</button>
        <button onclick="clearNotification()" class="secondary">Clear Active</button>
      </div>
    </div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBvgAQeSP5B8mKICA-4vHRY0CaO8MyeizU",
  authDomain: "dark-zone-toolkit-d67ab.firebaseapp.com",
  databaseURL: "https://dark-zone-toolkit-d67ab-default-rtdb.firebaseio.com",
  projectId: "dark-zone-toolkit-d67ab"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const rdb = firebase.database();

let currentUser = null;
let allTools = [];
let reports = [];

// Check if already logged in
auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    loadAllData();
  }
});

function login() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const errorEl = document.getElementById('loginError');
  
  auth.signInWithEmailAndPassword(email, password)
    .catch(error => {
      errorEl.textContent = error.message;
      errorEl.style.display = 'block';
    });
}

function logout() {
  auth.signOut();
  document.getElementById('loginForm').classList.remove('hidden');
  document.getElementById('adminPanel').classList.add('hidden');
}

function switchTab(tabName) {
  // Update tabs
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Update content
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  document.getElementById(tabName).classList.add('active');
  
  // Refresh data if needed
  if (tabName === 'reports') loadReports();
  if (tabName === 'analytics') loadAnalytics();
}

async function loadAllData() {
  // Load settings
  db.collection("settings").doc("main").get().then(doc => {
    if (doc.exists) {
      const data = doc.data();
      document.getElementById('toolkitName').value = data.toolkitName || '';
      document.getElementById('toolkitSubtitle').value = data.subtitle || '';
      document.getElementById('welcomeMessage').value = data.welcomeMessage || '';
      document.getElementById('broadcastMessage').value = data.broadcastMessage || '';
      document.getElementById('whatsappChannel').value = data.whatsappChannel || '';
      document.getElementById('footerText').value = data.footerText || '';
    }
  });
  
  // Load tools
  db.collection("tools").onSnapshot(snapshot => {
    allTools = [];
    snapshot.forEach(doc => {
      allTools.push({ id: doc.id, ...doc.data() });
    });
    updateToolsList();
    document.getElementById('totalTools').textContent = allTools.length;
  });
  
  // Load analytics
  rdb.ref("toolClicks").once("value").then(snapshot => {
    let totalClicks = 0;
    snapshot.forEach(child => {
      totalClicks += child.val();
    });
    document.getElementById('totalClicks').textContent = totalClicks;
  });
  
  // Load user count
  rdb.ref("stats/totalUsers").once("value").then(snapshot => {
    document.getElementById('totalUsers').textContent = snapshot.val() || 0;
  });
  
  // Load reports
  loadReports();
}

function updateToolsList() {
  const toolsList = document.getElementById('toolsList');
  toolsList.innerHTML = '';
  
  allTools.forEach(tool => {
    const toolItem = document.createElement('div');
    toolItem.className = 'tool-item';
    toolItem.innerHTML = `
      <div class="tool-info">
        <div class="tool-icon">${tool.icon || 'üõ†Ô∏è'}</div>
        <div>
          <strong>${tool.name}</strong><br>
          <small>${tool.type} ‚Ä¢ ${tool.enabled ? 'Enabled' : 'Disabled'}</small>
        </div>
      </div>
      <div class="tool-actions">
        <button onclick="editTool('${tool.id}')" style="padding: 5px 10px; font-size: 12px;">Edit</button>
        <button onclick="deleteTool('${tool.id}')" class="danger" style="padding: 5px 10px; font-size: 12px;">Delete</button>
      </div>
    `;
    toolsList.appendChild(toolItem);
  });
}

function editTool(toolId) {
  const tool = allTools.find(t => t.id === toolId);
  if (!tool) return;
  
  document.getElementById('toolId').value = tool.id;
  document.getElementById('toolName').value = tool.name;
  document.getElementById('toolIcon').value = tool.icon || '';
  document.getElementById('toolType').value = tool.type;
  document.getElementById('toolUrl').value = tool.url || '';
  document.getElementById('toolEnabled').checked = tool.enabled !== false;
  document.getElementById('toolPro').checked = tool.pro === true;
  
  // Load HTML if hosted tool
  if (tool.type === 'hosted') {
    db.collection("hosted_tools").doc(tool.id).get().then(doc => {
      if (doc.exists) {
        document.getElementById('toolHtml').value = doc.data().html || '';
      }
    });
  }
  
  switchTab('tools');
}

function saveTool() {
  const toolId = document.getElementById('toolId').value.trim();
  const toolName = document.getElementById('toolName').value.trim();
  const toolType = document.getElementById('toolType').value;
  
  if (!toolId || !toolName) {
    alert('Please enter Tool ID and Name');
    return;
  }
  
  const toolData = {
    name: toolName,
    icon: document.getElementById('toolIcon').value,
    type: toolType,
    url: toolType === 'direct' ? document.getElementById('toolUrl').value : '',
    enabled: document.getElementById('toolEnabled').checked,
    pro: document.getElementById('toolPro').checked,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  
  // Save tool data
  db.collection("tools").doc(toolId).set(toolData)
    .then(() => {
      // Save HTML if hosted tool
      if (toolType === 'hosted') {
        const html = document.getElementById('toolHtml').value;
        return db.collection("hosted_tools").doc(toolId).set({ html: html });
      }
    })
    .then(() => {
      alert('Tool saved successfully!');
      clearToolForm();
    })
    .catch(error => {
      alert('Error saving tool: ' + error.message);
    });
}

function deleteTool(toolId) {
  if (!confirm('Are you sure you want to delete this tool?')) return;
  
  db.collection("tools").doc(toolId).delete()
    .then(() => {
      db.collection("hosted_tools").doc(toolId).delete();
      alert('Tool deleted!');
    })
    .catch(error => {
      alert('Error deleting tool: ' + error.message);
    });
}

function clearToolForm() {
  document.getElementById('toolId').value = '';
  document.getElementById('toolName').value = '';
  document.getElementById('toolIcon').value = '';
  document.getElementById('toolUrl').value = '';
  document.getElementById('toolHtml').value = '';
  document.getElementById('toolEnabled').checked = true;
  document.getElementById('toolPro').checked = false;
}

function saveSettings() {
  const settings = {
    toolkitName: document.getElementById('toolkitName').value,
    subtitle: document.getElementById('toolkitSubtitle').value,
    welcomeMessage: document.getElementById('welcomeMessage').value,
    broadcastMessage: document.getElementById('broadcastMessage').value,
    whatsappChannel: document.getElementById('whatsappChannel').value,
    footerText: document.getElementById('footerText').value,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  
  db.collection("settings").doc("main").set(settings, { merge: true })
    .then(() => alert('Settings saved!'))
    .catch(error => alert('Error: ' + error.message));
}

async function loadReports() {
  const snapshot = await db.collection("reports")
    .orderBy("timestamp", "desc")
    .limit(50)
    .get();
  
  reports = [];
  snapshot.forEach(doc => {
    reports.push({ id: doc.id, ...doc.data() });
  });
  
  updateReportsList();
}

function updateReportsList() {
  const reportsList = document.getElementById('reportsList');
  reportsList.innerHTML = '';
  
  const pendingCount = reports.filter(r => !r.resolved).length;
  document.getElementById('pendingReports').textContent = pendingCount;
  
  if (reports.length === 0) {
    reportsList.innerHTML = '<p>No reports yet.</p>';
    return;
  }
  
  reports.forEach(report => {
    const reportItem = document.createElement('div');
    reportItem.className = `report-item ${report.resolved ? 'resolved' : ''}`;
    reportItem.innerHTML = `
      <div>
        <strong>${report.message}</strong>
        <span class="status-badge ${report.resolved ? 'status-resolved' : 'status-pending'}">
          ${report.resolved ? 'RESOLVED' : 'PENDING'}
        </span>
        ${report.resolved ? '' : `<button onclick="resolveReport('${report.id}')" style="float: right; padding: 3px 8px; font-size: 11px;">Mark Resolved</button>`}
      </div>
      <div class="report-meta">
        ${new Date(report.timestamp?.toDate() || Date.now()).toLocaleString()}
        ${report.userId ? ` ‚Ä¢ User: ${report.userId.substring(0, 8)}...` : ''}
      </div>
    `;
    reportsList.appendChild(reportItem);
  });
}

function resolveReport(reportId) {
  db.collection("reports").doc(reportId).update({
    resolved: true,
    resolvedAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    loadReports();
  });
}

async function loadAnalytics() {
  const analyticsList = document.getElementById('analyticsList');
  analyticsList.innerHTML = '<p>Loading analytics...</p>';
  
  // Get tool clicks
  const clicksSnapshot = await rdb.ref("toolClicks").once("value");
  const clicks = [];
  clicksSnapshot.forEach(child => {
    clicks.push({ toolId: child.key, clicks: child.val() });
  });
  
  // Sort by clicks
  clicks.sort((a, b) => b.clicks - a.clicks);
  
  let html = '<h4>Tool Popularity</h4>';
  clicks.forEach(item => {
    const tool = allTools.find(t => t.id === item.toolId);
    const toolName = tool ? tool.name : item.toolId;
    html += `
      <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
        <strong>${toolName}</strong>: ${item.clicks} clicks
        <div style="height: 5px; background: rgba(0,234,255,0.3); border-radius: 3px; margin-top: 5px;">
          <div style="height: 100%; background: #00eaff; width: ${Math.min(100, (item.clicks / Math.max(1, clicks[0]?.clicks || 1)) * 100)}%; border-radius: 3px;"></div>
        </div>
      </div>
    `;
  });
  
  analyticsList.innerHTML = html;
}

function sendNotification() {
  const message = document.getElementById('notificationMessage').value.trim();
  const type = document.getElementById('notificationType').value;
  
  if (!message) {
    alert('Please enter a notification message');
    return;
  }
  
  const notification = {
    message: message,
    type: type,
    active: true,
    timestamp: Date.now(),
    sentBy: currentUser.email
  };
  
  rdb.ref("notifications").set(notification)
    .then(() => {
      alert('Notification sent!');
      document.getElementById('notificationMessage').value = '';
    })
    .catch(error => {
      alert('Error: ' + error.message);
    });
}

function clearNotification() {
  rdb.ref("notifications").set({
    active: false,
    timestamp: Date.now()
  })
  .then(() => {
    alert('Notification cleared!');
  });
}
</script>
</body>
</html>